<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mac Startup Test</title>
  <style>
    body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; color: white; }
    .msg { font-size: 24px; }
  </style>
</head>
<body>
  <div class="msg">Waiting 1 second for Mac startup sound...</div>

  <!-- MAC STARTUP SOUND -->
  <audio id="mac-startup" src="/assets/sounds/mac-startup-sound.mp3" preload="auto"></audio>

  <script>
    (function () {
      const audio = document.getElementById('mac-startup');
      if (!audio) {
        console.error("Audio element not found!");
        return;
      }

      const KEY = 'macos-audio-unlocked';
      let unlocked = localStorage.getItem(KEY) === 'true';

      console.log("Unlocked status:", unlocked);

      // Create silent unlock audio
      const unlocker = document.createElement('audio');
      unlocker.src = 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAGQ=';
      unlocker.volume = 0;
      document.body.appendChild(unlocker);

      function playMac() {
        if (!unlocked) return;
        console.log("Playing Mac startup sound...");
        audio.currentTime = 0;
        audio.play().catch(err => console.error("Play failed:", err));
      }

      // UNLOCK AFTER 1 SECOND
      if (!unlocked) {
        console.log("Unlocking in 1 second...");
        setTimeout(() => {
          unlocker.play().catch(err => console.log("Silent unlock failed (normal):", err));
          unlocked = true;
          localStorage.setItem(KEY, 'true');
          setTimeout(playMac, 100);
        }, 1000);
      } else {
        console.log("Already unlocked â€” playing now");
        setTimeout(playMac, 100);
      }

      // REFRESH SUPPORT
      window.addEventListener('pageshow', (e) => {
        if (e.persisted || !e.persisted) {
          setTimeout(() => {
            if (unlocked) playMac();
          }, 150);
        }
      });

      // Cleanup
      setTimeout(() => unlocker.remove(), 5000);
    })();
  </script>
</body>
</html>